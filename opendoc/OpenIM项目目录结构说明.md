# OpenIMé¡¹ç›®ç›®å½•ç»“æ„è¯¦ç»†è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜OpenIMé¡¹ç›®çš„ç›®å½•ç»“æ„ï¼ŒåŒ…æ‹¬æ¯ä¸ªç›®å½•å’Œæ–‡ä»¶çš„ä½œç”¨ã€èŒè´£å’Œå…³é”®å®ç°ã€‚OpenIMé‡‡ç”¨æ ‡å‡†çš„Goé¡¹ç›®å¸ƒå±€ï¼Œéµå¾ªç°ä»£å¾®æœåŠ¡æ¶æ„çš„æœ€ä½³å®è·µã€‚

---

## ğŸŒ³ é¡¹ç›®æ ¹ç›®å½•ç»“æ„

```
open-im-server/
â”œâ”€â”€ ğŸ“ cmd/                    # åº”ç”¨ç¨‹åºå…¥å£ç‚¹
â”œâ”€â”€ ğŸ“ internal/               # ç§æœ‰åº”ç”¨ç¨‹åºå’Œåº“ä»£ç 
â”œâ”€â”€ ğŸ“ pkg/                    # å¤–éƒ¨åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨çš„åº“ä»£ç 
â”œâ”€â”€ ğŸ“ config/                 # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”œâ”€â”€ ğŸ“ deployments/            # ç³»ç»Ÿå’Œå®¹å™¨ç¼–æ’éƒ¨ç½²é…ç½®
â”œâ”€â”€ ğŸ“ docs/                   # è®¾è®¡å’Œç”¨æˆ·æ–‡æ¡£
â”œâ”€â”€ ğŸ“ scripts/                # æ‰§è¡Œå„ç§æ„å»ºã€å®‰è£…ã€åˆ†æç­‰æ“ä½œçš„è„šæœ¬
â”œâ”€â”€ ğŸ“ test/                   # é¢å¤–çš„å¤–éƒ¨æµ‹è¯•åº”ç”¨ç¨‹åºå’Œæµ‹è¯•æ•°æ®
â”œâ”€â”€ ğŸ“ tools/                  # æ”¯æŒå·¥å…·
â”œâ”€â”€ ğŸ“ version/                # ç‰ˆæœ¬ä¿¡æ¯
â”œâ”€â”€ ğŸ“ assets/                 # é¡¹ç›®èµ„æºæ–‡ä»¶
â”œâ”€â”€ ğŸ“ build/                  # æ‰“åŒ…å’ŒæŒç»­é›†æˆ
â”œâ”€â”€ ğŸ“ _output/                # æ„å»ºè¾“å‡ºç›®å½•
â”œâ”€â”€ ğŸ“„ go.mod                  # Goæ¨¡å—æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ go.sum                  # Goæ¨¡å—æ ¡éªŒæ–‡ä»¶
â”œâ”€â”€ ğŸ“„ Dockerfile              # Dockeré•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ ğŸ“„ docker-compose.yml      # Docker Composeé…ç½®
â”œâ”€â”€ ğŸ“„ start-config.yml        # æœåŠ¡å¯åŠ¨é…ç½®
â”œâ”€â”€ ğŸ“„ install.sh              # å®‰è£…è„šæœ¬
â”œâ”€â”€ ğŸ“„ README.md               # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â””â”€â”€ ğŸ“„ LICENSE                 # å¼€æºè®¸å¯è¯
```

---

## ğŸ“ `/cmd` - åº”ç”¨ç¨‹åºå…¥å£

### ç›®å½•ç»“æ„
```
cmd/
â”œâ”€â”€ openim-api/                # HTTP APIç½‘å…³æœåŠ¡
â”‚   â””â”€â”€ main.go               # APIç½‘å…³å¯åŠ¨å…¥å£
â”œâ”€â”€ openim-msggateway/         # WebSocketæ¶ˆæ¯ç½‘å…³
â”‚   â””â”€â”€ main.go               # WebSocketç½‘å…³å¯åŠ¨å…¥å£
â”œâ”€â”€ openim-push/               # æ¨é€æœåŠ¡
â”‚   â””â”€â”€ main.go               # æ¨é€æœåŠ¡å¯åŠ¨å…¥å£
â”œâ”€â”€ openim-msgtransfer/        # æ¶ˆæ¯ä¼ è¾“æœåŠ¡
â”‚   â””â”€â”€ main.go               # æ¶ˆæ¯ä¼ è¾“æœåŠ¡å¯åŠ¨å…¥å£
â”œâ”€â”€ openim-crontask/           # å®šæ—¶ä»»åŠ¡æœåŠ¡
â”‚   â””â”€â”€ main.go               # å®šæ—¶ä»»åŠ¡å¯åŠ¨å…¥å£
â”œâ”€â”€ openim-cmdutils/           # å‘½ä»¤è¡Œå·¥å…·
â”‚   â””â”€â”€ main.go               # å·¥å…·å…¥å£
â””â”€â”€ openim-rpc/                # RPCæœåŠ¡å…¥å£é›†åˆ
    â”œâ”€â”€ openim-rpc-auth/       # è®¤è¯RPCæœåŠ¡
    â”‚   â””â”€â”€ main.go           # è®¤è¯æœåŠ¡å¯åŠ¨å…¥å£
    â”œâ”€â”€ openim-rpc-user/       # ç”¨æˆ·RPCæœåŠ¡
    â”‚   â””â”€â”€ main.go           # ç”¨æˆ·æœåŠ¡å¯åŠ¨å…¥å£
    â”œâ”€â”€ openim-rpc-msg/        # æ¶ˆæ¯RPCæœåŠ¡
    â”‚   â””â”€â”€ main.go           # æ¶ˆæ¯æœåŠ¡å¯åŠ¨å…¥å£
    â”œâ”€â”€ openim-rpc-conversation/ # ä¼šè¯RPCæœåŠ¡
    â”‚   â””â”€â”€ main.go           # ä¼šè¯æœåŠ¡å¯åŠ¨å…¥å£
    â”œâ”€â”€ openim-rpc-group/      # ç¾¤ç»„RPCæœåŠ¡
    â”‚   â””â”€â”€ main.go           # ç¾¤ç»„æœåŠ¡å¯åŠ¨å…¥å£
    â”œâ”€â”€ openim-rpc-relation/   # å…³ç³»RPCæœåŠ¡
    â”‚   â””â”€â”€ main.go           # å…³ç³»æœåŠ¡å¯åŠ¨å…¥å£
    â””â”€â”€ openim-rpc-third/      # ç¬¬ä¸‰æ–¹RPCæœåŠ¡
        â””â”€â”€ main.go           # ç¬¬ä¸‰æ–¹æœåŠ¡å¯åŠ¨å…¥å£
```

### å…³é”®ç‰¹æ€§
- **å•ä¸€èŒè´£**: æ¯ä¸ªmain.goæ–‡ä»¶åªè´Ÿè´£ä¸€ä¸ªæœåŠ¡çš„å¯åŠ¨
- **é…ç½®åŠ è½½**: ç»Ÿä¸€çš„é…ç½®åŠ è½½å’Œè§£ææœºåˆ¶
- **ä¼˜é›…å…³é—­**: æ”¯æŒä¼˜é›…å…³é—­å’Œä¿¡å·å¤„ç†
- **å¥åº·æ£€æŸ¥**: å†…ç½®å¥åº·æ£€æŸ¥ç«¯ç‚¹

### å…¸å‹å¯åŠ¨æµç¨‹
```go
func main() {
    // 1. é…ç½®åŠ è½½
    config := config.LoadConfig()
    
    // 2. æ—¥å¿—åˆå§‹åŒ–
    logger := log.NewLogger(config.Log)
    
    // 3. æœåŠ¡åˆå§‹åŒ–
    server := newServer(config, logger)
    
    // 4. å¯åŠ¨æœåŠ¡
    server.Start()
    
    // 5. ä¼˜é›…å…³é—­
    gracefulShutdown(server)
}
```

---

## ğŸ“ `/internal` - æ ¸å¿ƒä¸šåŠ¡å®ç°

### ç›®å½•ç»“æ„
```
internal/
â”œâ”€â”€ api/                       # HTTP APIå®ç°
â”‚   â”œâ”€â”€ auth.go               # è®¤è¯ç›¸å…³API
â”‚   â”œâ”€â”€ user.go               # ç”¨æˆ·ç®¡ç†API
â”‚   â”œâ”€â”€ msg.go                # æ¶ˆæ¯ç›¸å…³API
â”‚   â”œâ”€â”€ conversation.go       # ä¼šè¯ç®¡ç†API
â”‚   â”œâ”€â”€ group.go              # ç¾¤ç»„ç®¡ç†API
â”‚   â”œâ”€â”€ friend.go             # å¥½å‹å…³ç³»API
â”‚   â”œâ”€â”€ third.go              # ç¬¬ä¸‰æ–¹æœåŠ¡API
â”‚   â”œâ”€â”€ middleware.go         # ä¸­é—´ä»¶
â”‚   â””â”€â”€ router.go             # è·¯ç”±é…ç½®
â”œâ”€â”€ msggateway/               # WebSocketæ¶ˆæ¯ç½‘å…³
â”‚   â”œâ”€â”€ ws_server.go          # WebSocketæœåŠ¡å™¨
â”‚   â”œâ”€â”€ client.go             # å®¢æˆ·ç«¯è¿æ¥ç®¡ç†
â”‚   â”œâ”€â”€ hub_server.go         # æ¶ˆæ¯åˆ†å‘ä¸­å¿ƒ
â”‚   â”œâ”€â”€ message_handler.go    # æ¶ˆæ¯å¤„ç†å™¨
â”‚   â”œâ”€â”€ user_map.go           # ç”¨æˆ·æ˜ å°„ç®¡ç†
â”‚   â”œâ”€â”€ online.go             # åœ¨çº¿çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ subscription.go       # è®¢é˜…ç®¡ç†
â”‚   â”œâ”€â”€ compressor.go         # æ¶ˆæ¯å‹ç¼©
â”‚   â”œâ”€â”€ encoder.go            # æ¶ˆæ¯ç¼–ç 
â”‚   â””â”€â”€ options.go            # é…ç½®é€‰é¡¹
â”œâ”€â”€ push/                     # æ¨é€æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ push.go               # æ¨é€æœåŠ¡ä¸»é€»è¾‘
â”‚   â”œâ”€â”€ push_handler.go       # æ¨é€å¤„ç†å™¨
â”‚   â”œâ”€â”€ onlinepusher.go       # åœ¨çº¿æ¨é€å™¨
â”‚   â”œâ”€â”€ offlinepush_handler.go # ç¦»çº¿æ¨é€å¤„ç†
â”‚   â”œâ”€â”€ callback.go           # æ¨é€å›è°ƒ
â”‚   â””â”€â”€ offlinepush/          # ç¦»çº¿æ¨é€å®ç°
â”‚       â”œâ”€â”€ dummy/            # ç©ºæ¨é€å®ç°
â”‚       â”œâ”€â”€ fcm/              # Firebaseæ¨é€
â”‚       â”œâ”€â”€ getui/            # ä¸ªæ¨æ¨é€
â”‚       â””â”€â”€ jpush/            # æå…‰æ¨é€
â”œâ”€â”€ msgtransfer/              # æ¶ˆæ¯ä¼ è¾“æœåŠ¡
â”‚   â”œâ”€â”€ init.go               # æœåŠ¡åˆå§‹åŒ–
â”‚   â”œâ”€â”€ online_history_msg_handler.go # åœ¨çº¿å†å²æ¶ˆæ¯å¤„ç†
â”‚   â””â”€â”€ online_msg_to_mongo_handler.go # MongoDBæ¶ˆæ¯å¤„ç†
â”œâ”€â”€ tools/                    # å†…éƒ¨å·¥å…·
â”‚   â”œâ”€â”€ cron/                 # å®šæ—¶ä»»åŠ¡
â”‚   â””â”€â”€ seq/                  # åºåˆ—å·ç”Ÿæˆå™¨
â””â”€â”€ rpc/                      # RPCæœåŠ¡å®ç°
    â”œâ”€â”€ auth/                 # è®¤è¯æœåŠ¡
    â”‚   â”œâ”€â”€ auth.go           # è®¤è¯æœåŠ¡å®ç°
    â”‚   â””â”€â”€ token.go          # Tokenç®¡ç†
    â”œâ”€â”€ user/                 # ç”¨æˆ·æœåŠ¡
    â”‚   â”œâ”€â”€ user.go           # ç”¨æˆ·æœåŠ¡å®ç°
    â”‚   â”œâ”€â”€ online.go         # åœ¨çº¿çŠ¶æ€ç®¡ç†
    â”‚   â”œâ”€â”€ notification.go   # ç”¨æˆ·é€šçŸ¥
    â”‚   â””â”€â”€ statistics.go     # ç”¨æˆ·ç»Ÿè®¡
    â”œâ”€â”€ msg/                  # æ¶ˆæ¯æœåŠ¡
    â”‚   â”œâ”€â”€ send.go           # æ¶ˆæ¯å‘é€
    â”‚   â”œâ”€â”€ sync_msg.go       # æ¶ˆæ¯åŒæ­¥
    â”‚   â”œâ”€â”€ verify.go         # æ¶ˆæ¯éªŒè¯
    â”‚   â”œâ”€â”€ revoke.go         # æ¶ˆæ¯æ’¤å›
    â”‚   â””â”€â”€ delete.go         # æ¶ˆæ¯åˆ é™¤
    â”œâ”€â”€ conversation/         # ä¼šè¯æœåŠ¡
    â”‚   â”œâ”€â”€ conversation.go   # ä¼šè¯ç®¡ç†
    â”‚   â”œâ”€â”€ sync.go           # ä¼šè¯åŒæ­¥
    â”‚   â””â”€â”€ notification.go   # ä¼šè¯é€šçŸ¥
    â”œâ”€â”€ group/                # ç¾¤ç»„æœåŠ¡
    â”‚   â”œâ”€â”€ group.go          # ç¾¤ç»„ç®¡ç†
    â”‚   â”œâ”€â”€ sync.go           # ç¾¤ç»„åŒæ­¥
    â”‚   â”œâ”€â”€ statistics.go     # ç¾¤ç»„ç»Ÿè®¡
    â”‚   â”œâ”€â”€ notification.go   # ç¾¤ç»„é€šçŸ¥
    â”‚   â””â”€â”€ callback.go       # ç¾¤ç»„å›è°ƒ
    â”œâ”€â”€ relation/             # å…³ç³»æœåŠ¡
    â”‚   â”œâ”€â”€ friend.go         # å¥½å‹ç®¡ç†
    â”‚   â”œâ”€â”€ black.go          # é»‘åå•ç®¡ç†
    â”‚   â”œâ”€â”€ sync.go           # å…³ç³»åŒæ­¥
    â”‚   â””â”€â”€ notification.go   # å…³ç³»é€šçŸ¥
    â””â”€â”€ third/                # ç¬¬ä¸‰æ–¹æœåŠ¡
        â”œâ”€â”€ third.go          # ç¬¬ä¸‰æ–¹æœåŠ¡å®ç°
        â”œâ”€â”€ s3.go             # å¯¹è±¡å­˜å‚¨
        â”œâ”€â”€ fcm.go            # Firebaseé›†æˆ
        â””â”€â”€ webhook.go        # Webhookå¤„ç†
```

---

## ğŸ“ `/pkg` - å…¬å…±åº“ä»£ç 

### ç›®å½•ç»“æ„
```
pkg/
â”œâ”€â”€ common/                    # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ config/               # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ config.go         # é…ç½®ç»“æ„ä½“å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ parse.go          # é…ç½®è§£æ
â”‚   â”‚   â””â”€â”€ validate.go       # é…ç½®éªŒè¯
â”‚   â”œâ”€â”€ storage/              # å­˜å‚¨æŠ½è±¡å±‚
â”‚   â”‚   â”œâ”€â”€ cache/            # ç¼“å­˜æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ redis.go      # Rediså®ç°
â”‚   â”‚   â”‚   â””â”€â”€ interface.go  # ç¼“å­˜æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ database/         # æ•°æ®åº“æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ mongo.go      # MongoDBå®ç°
â”‚   â”‚   â”‚   â””â”€â”€ interface.go  # æ•°æ®åº“æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ controller/       # å­˜å‚¨æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ user.go       # ç”¨æˆ·æ•°æ®æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ msg.go        # æ¶ˆæ¯æ•°æ®æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â””â”€â”€ group.go      # ç¾¤ç»„æ•°æ®æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ model/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ user.go       # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ msg.go        # æ¶ˆæ¯æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ group.go      # ç¾¤ç»„æ¨¡å‹
â”‚   â”‚   â””â”€â”€ kafka/            # Kafkaå°è£…
â”‚   â”‚       â”œâ”€â”€ producer.go   # æ¶ˆæ¯ç”Ÿäº§è€…
â”‚   â”‚       â””â”€â”€ consumer.go   # æ¶ˆæ¯æ¶ˆè´¹è€…
â”‚   â”œâ”€â”€ webhook/              # Webhookç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ webhook.go        # Webhookå¤„ç†
â”‚   â”‚   â””â”€â”€ client.go         # HTTPå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ convert/              # æ•°æ®è½¬æ¢å·¥å…·
â”‚   â”‚   â”œâ”€â”€ user.go           # ç”¨æˆ·æ•°æ®è½¬æ¢
â”‚   â”‚   â”œâ”€â”€ msg.go            # æ¶ˆæ¯æ•°æ®è½¬æ¢
â”‚   â”‚   â””â”€â”€ group.go          # ç¾¤ç»„æ•°æ®è½¬æ¢
â”‚   â””â”€â”€ cmd/                  # å‘½ä»¤è¡Œå·¥å…·
â”‚       â”œâ”€â”€ root.go           # æ ¹å‘½ä»¤
â”‚       â””â”€â”€ version.go        # ç‰ˆæœ¬å‘½ä»¤
â”œâ”€â”€ apistruct/                # APIç»“æ„ä½“å®šä¹‰
â”‚   â”œâ”€â”€ manage.go             # ç®¡ç†APIç»“æ„ä½“
â”‚   â”œâ”€â”€ msg.go                # æ¶ˆæ¯APIç»“æ„ä½“
â”‚   â””â”€â”€ public.go             # å…¬å…±APIç»“æ„ä½“
â”œâ”€â”€ authverify/               # èº«ä»½éªŒè¯å·¥å…·
â”‚   â””â”€â”€ token.go              # JWTä»¤ç‰ŒéªŒè¯
â”œâ”€â”€ callbackstruct/           # å›è°ƒç»“æ„ä½“å®šä¹‰
â”‚   â”œâ”€â”€ black.go              # é»‘åå•å›è°ƒ
â”‚   â”œâ”€â”€ common.go             # é€šç”¨å›è°ƒ
â”‚   â”œâ”€â”€ constant.go           # å›è°ƒå¸¸é‡
â”‚   â”œâ”€â”€ friend.go             # å¥½å‹å›è°ƒ
â”‚   â”œâ”€â”€ group.go              # ç¾¤ç»„å›è°ƒ
â”‚   â”œâ”€â”€ message.go            # æ¶ˆæ¯å›è°ƒ
â”‚   â”œâ”€â”€ msg_gateway.go        # æ¶ˆæ¯ç½‘å…³å›è°ƒ
â”‚   â””â”€â”€ user.go               # ç”¨æˆ·å›è°ƒ
â”œâ”€â”€ localcache/               # æœ¬åœ°ç¼“å­˜ç»„ä»¶
â”‚   â”œâ”€â”€ lru.go                # LRUç¼“å­˜å®ç°
â”‚   â””â”€â”€ interface.go          # ç¼“å­˜æ¥å£
â”œâ”€â”€ msgprocessor/             # æ¶ˆæ¯å¤„ç†å™¨
â”‚   â”œâ”€â”€ processor.go          # æ¶ˆæ¯å¤„ç†å™¨
â”‚   â””â”€â”€ filter.go             # æ¶ˆæ¯è¿‡æ»¤å™¨
â”œâ”€â”€ notification/             # é€šçŸ¥ç»„ä»¶
â”‚   â”œâ”€â”€ notification.go       # é€šçŸ¥å¤„ç†
â”‚   â””â”€â”€ template.go           # é€šçŸ¥æ¨¡æ¿
â”œâ”€â”€ rpccache/                 # RPCç¼“å­˜ç»„ä»¶
â”‚   â”œâ”€â”€ online.go             # åœ¨çº¿çŠ¶æ€ç¼“å­˜
â”‚   â”œâ”€â”€ user.go               # ç”¨æˆ·ä¿¡æ¯ç¼“å­˜
â”‚   â””â”€â”€ group.go              # ç¾¤ç»„ä¿¡æ¯ç¼“å­˜
â”œâ”€â”€ rpcli/                    # RPCå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ auth.go               # è®¤è¯RPCå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ user.go               # ç”¨æˆ·RPCå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ msg.go                # æ¶ˆæ¯RPCå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ group.go              # ç¾¤ç»„RPCå®¢æˆ·ç«¯
â”‚   â””â”€â”€ relation.go           # å…³ç³»RPCå®¢æˆ·ç«¯
â”œâ”€â”€ statistics/               # ç»Ÿè®¡ç»„ä»¶
â”‚   â”œâ”€â”€ statistics.go         # ç»Ÿè®¡æ•°æ®å¤„ç†
â”‚   â””â”€â”€ metrics.go            # æŒ‡æ ‡æ”¶é›†
â”œâ”€â”€ tools/                    # å·¥å…·åŒ…
â”‚   â”œâ”€â”€ batcher/              # æ‰¹å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ batcher.go        # æ‰¹å¤„ç†å®ç°
â”‚   â”‚   â””â”€â”€ interface.go      # æ‰¹å¤„ç†æ¥å£
â”‚   â”œâ”€â”€ checker/              # æ£€æŸ¥å·¥å…·
â”‚   â”‚   â”œâ”€â”€ health.go         # å¥åº·æ£€æŸ¥
â”‚   â”‚   â””â”€â”€ resource.go       # èµ„æºæ£€æŸ¥
â”‚   â”œâ”€â”€ discovery/            # æœåŠ¡å‘ç°
â”‚   â”‚   â”œâ”€â”€ consul.go         # Consulå®ç°
â”‚   â”‚   â”œâ”€â”€ etcd.go           # etcdå®ç°
â”‚   â”‚   â””â”€â”€ interface.go      # æœåŠ¡å‘ç°æ¥å£
â”‚   â””â”€â”€ component/            # ç»„ä»¶ç®¡ç†
â”‚       â”œâ”€â”€ component.go      # ç»„ä»¶æ¥å£
â”‚       â””â”€â”€ manager.go        # ç»„ä»¶ç®¡ç†å™¨
â””â”€â”€ util/                     # å·¥å…·å‡½æ•°
    â”œâ”€â”€ stringutil/           # å­—ç¬¦ä¸²å·¥å…·
    â”œâ”€â”€ timeutil/             # æ—¶é—´å·¥å…·
    â”œâ”€â”€ hashutil/             # å“ˆå¸Œå·¥å…·
    â”œâ”€â”€ idutil/               # IDç”Ÿæˆå·¥å…·
    â””â”€â”€ netutil/              # ç½‘ç»œå·¥å…·
```

---

## ğŸ“ `/config` - é…ç½®æ–‡ä»¶

### ç›®å½•ç»“æ„
```
config/
â”œâ”€â”€ config.yaml               # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ notification.yaml         # é€šçŸ¥é…ç½®
â”œâ”€â”€ webhooks.yaml            # Webhooké…ç½®
â”œâ”€â”€ prometheus.yml           # Prometheusé…ç½®
â”œâ”€â”€ alertmanager.yml         # å‘Šè­¦é…ç½®
â”œâ”€â”€ grafana/                 # Grafanaé…ç½®
â”‚   â”œâ”€â”€ dashboards/          # ä»ªè¡¨ç›˜é…ç½®
â”‚   â””â”€â”€ provisioning/        # è‡ªåŠ¨é…ç½®
â”œâ”€â”€ templates/               # é…ç½®æ¨¡æ¿
â”‚   â”œâ”€â”€ env.template         # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚   â””â”€â”€ docker.template      # Dockeré…ç½®æ¨¡æ¿
â””â”€â”€ README.md                # é…ç½®è¯´æ˜æ–‡æ¡£
```

### é…ç½®æ–‡ä»¶è¯´æ˜

#### ä¸»é…ç½®æ–‡ä»¶ (config.yaml)
```yaml
# æœåŠ¡å‘ç°é…ç½®
zookeeper:
  schema: "openim"
  zkAddr: ["127.0.0.1:2181"]
  username: ""
  password: ""

# æ•°æ®åº“é…ç½®
mysql:
  address: ["127.0.0.1:13306"]
  username: "root"
  password: "openIM123"
  database: "openIM_v3"
  maxOpenConn: 100
  maxIdleConn: 10
  maxLifeTime: 5

# Redisé…ç½®
redis:
  address: ["127.0.0.1:16379"]
  username: ""
  password: "openIM123"
  clusterMode: false

# Kafkaé…ç½®
kafka:
  addr: ["127.0.0.1:9092"]
  latestMsgToRedis:
    topic: "latestMsgToRedis"
  msgToPush:
    topic: "msgToPush"
  msgToMongo:
    topic: "msgToMongo"
```

---

## ğŸ“ `/deployments` - éƒ¨ç½²é…ç½®

### ç›®å½•ç»“æ„
```
deployments/
â”œâ”€â”€ docker-compose/           # Docker Composeéƒ¨ç½²
â”‚   â”œâ”€â”€ docker-compose.yml   # ä¸»è¦æœåŠ¡ç¼–æ’
â”‚   â”œâ”€â”€ docker-compose.override.yml # å¼€å‘ç¯å¢ƒè¦†ç›–
â”‚   â””â”€â”€ .env                 # ç¯å¢ƒå˜é‡
â”œâ”€â”€ kubernetes/              # Kuberneteséƒ¨ç½²
â”‚   â”œâ”€â”€ namespace.yaml       # å‘½åç©ºé—´
â”‚   â”œâ”€â”€ configmap.yaml       # é…ç½®æ˜ å°„
â”‚   â”œâ”€â”€ secret.yaml          # å¯†é’¥
â”‚   â”œâ”€â”€ deployment.yaml      # éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ service.yaml         # æœåŠ¡é…ç½®
â”‚   â”œâ”€â”€ ingress.yaml         # å…¥å£é…ç½®
â”‚   â””â”€â”€ hpa.yaml             # æ°´å¹³æ‰©å±•é…ç½®
â”œâ”€â”€ systemd/                 # SystemdæœåŠ¡
â”‚   â”œâ”€â”€ openim-api.service   # APIæœåŠ¡
â”‚   â”œâ”€â”€ openim-msggateway.service # æ¶ˆæ¯ç½‘å…³æœåŠ¡
â”‚   â””â”€â”€ openim.target        # æœåŠ¡ç»„
â”œâ”€â”€ helm/                    # Helm Chart
â”‚   â”œâ”€â”€ Chart.yaml           # Chartå…ƒæ•°æ®
â”‚   â”œâ”€â”€ values.yaml          # é»˜è®¤å€¼
â”‚   â”œâ”€â”€ templates/           # æ¨¡æ¿æ–‡ä»¶
â”‚   â””â”€â”€ charts/              # ä¾èµ–Chart
â””â”€â”€ terraform/               # Terraformé…ç½®
    â”œâ”€â”€ main.tf              # ä¸»é…ç½®
    â”œâ”€â”€ variables.tf         # å˜é‡å®šä¹‰
    â””â”€â”€ outputs.tf           # è¾“å‡ºå®šä¹‰
```

---

## ğŸ“ `/scripts` - è„šæœ¬æ–‡ä»¶

### ç›®å½•ç»“æ„
```
scripts/
â”œâ”€â”€ build/                   # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ build.sh             # ä¸»æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ cross-build.sh       # äº¤å‰ç¼–è¯‘è„šæœ¬
â”‚   â””â”€â”€ docker-build.sh      # Dockeræ„å»ºè„šæœ¬
â”œâ”€â”€ install/                 # å®‰è£…è„šæœ¬
â”‚   â”œâ”€â”€ install.sh           # ä¸»å®‰è£…è„šæœ¬
â”‚   â”œâ”€â”€ install-docker.sh    # Dockerå®‰è£…
â”‚   â””â”€â”€ install-k8s.sh       # Kuberneteså®‰è£…
â”œâ”€â”€ check/                   # æ£€æŸ¥è„šæœ¬
â”‚   â”œâ”€â”€ check-all.sh         # å…¨é¢æ£€æŸ¥
â”‚   â”œâ”€â”€ check-component.sh   # ç»„ä»¶æ£€æŸ¥
â”‚   â””â”€â”€ check-free-memory.sh # å†…å­˜æ£€æŸ¥
â”œâ”€â”€ data/                    # æ•°æ®è„šæœ¬
â”‚   â”œâ”€â”€ init-data.sh         # åˆå§‹åŒ–æ•°æ®
â”‚   â”œâ”€â”€ backup.sh            # æ•°æ®å¤‡ä»½
â”‚   â””â”€â”€ restore.sh           # æ•°æ®æ¢å¤
â”œâ”€â”€ lib/                     # è„šæœ¬åº“
â”‚   â”œâ”€â”€ util.sh              # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ color.sh             # é¢œè‰²è¾“å‡º
â”‚   â””â”€â”€ log.sh               # æ—¥å¿—å‡½æ•°
â””â”€â”€ start-all.sh             # å¯åŠ¨æ‰€æœ‰æœåŠ¡
```

---

## ğŸ“ `/test` - æµ‹è¯•æ–‡ä»¶

### ç›®å½•ç»“æ„
```
test/
â”œâ”€â”€ e2e/                     # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”œâ”€â”€ auth_test.go         # è®¤è¯æµ‹è¯•
â”‚   â”œâ”€â”€ msg_test.go          # æ¶ˆæ¯æµ‹è¯•
â”‚   â”œâ”€â”€ group_test.go        # ç¾¤ç»„æµ‹è¯•
â”‚   â””â”€â”€ user_test.go         # ç”¨æˆ·æµ‹è¯•
â”œâ”€â”€ integration/             # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ api_test.go          # APIé›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ rpc_test.go          # RPCé›†æˆæµ‹è¯•
â”‚   â””â”€â”€ database_test.go     # æ•°æ®åº“æµ‹è¯•
â”œâ”€â”€ benchmark/               # æ€§èƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ msg_bench_test.go    # æ¶ˆæ¯æ€§èƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ user_bench_test.go   # ç”¨æˆ·æ€§èƒ½æµ‹è¯•
â”‚   â””â”€â”€ concurrent_test.go   # å¹¶å‘æµ‹è¯•
â”œâ”€â”€ mock/                    # æ¨¡æ‹Ÿæ•°æ®
â”‚   â”œâ”€â”€ user_mock.go         # ç”¨æˆ·æ¨¡æ‹Ÿ
â”‚   â”œâ”€â”€ msg_mock.go          # æ¶ˆæ¯æ¨¡æ‹Ÿ
â”‚   â””â”€â”€ group_mock.go        # ç¾¤ç»„æ¨¡æ‹Ÿ
â”œâ”€â”€ testdata/                # æµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ config/              # æµ‹è¯•é…ç½®
â”‚   â”œâ”€â”€ fixtures/            # å›ºå®šæ•°æ®
â”‚   â””â”€â”€ golden/              # é»„é‡‘æ–‡ä»¶
â””â”€â”€ README.md                # æµ‹è¯•è¯´æ˜
```

---

## ğŸ“ `/tools` - æ”¯æŒå·¥å…·

### ç›®å½•ç»“æ„
```
tools/
â”œâ”€â”€ codegen/                 # ä»£ç ç”Ÿæˆå·¥å…·
â”‚   â”œâ”€â”€ protogen/            # Protobufç”Ÿæˆ
â”‚   â”œâ”€â”€ mockgen/             # Mockç”Ÿæˆ
â”‚   â””â”€â”€ swagger/             # APIæ–‡æ¡£ç”Ÿæˆ
â”œâ”€â”€ migration/               # æ•°æ®è¿ç§»å·¥å…·
â”‚   â”œâ”€â”€ mysql/               # MySQLè¿ç§»
â”‚   â”œâ”€â”€ mongo/               # MongoDBè¿ç§»
â”‚   â””â”€â”€ redis/               # Redisè¿ç§»
â”œâ”€â”€ monitoring/              # ç›‘æ§å·¥å…·
â”‚   â”œâ”€â”€ prometheus/          # Prometheusé…ç½®
â”‚   â”œâ”€â”€ grafana/             # Grafanaä»ªè¡¨ç›˜
â”‚   â””â”€â”€ alerting/            # å‘Šè­¦è§„åˆ™
â”œâ”€â”€ component/               # ç»„ä»¶å·¥å…·
â”‚   â”œâ”€â”€ kafka/               # Kafkaå·¥å…·
â”‚   â”œâ”€â”€ redis/               # Rediså·¥å…·
â”‚   â””â”€â”€ mongo/               # MongoDBå·¥å…·
â””â”€â”€ README.md                # å·¥å…·è¯´æ˜
```

---

## ğŸ”§ å¼€å‘è§„èŒƒ

### 1. ç›®å½•å‘½åè§„èŒƒ
- ä½¿ç”¨å°å†™å­—æ¯å’ŒçŸ­æ¨ªçº¿
- ç›®å½•ååº”è¯¥ç®€æ´ä¸”å…·æœ‰æè¿°æ€§
- é¿å…ä½¿ç”¨ç¼©å†™ï¼Œé™¤éæ˜¯å¹¿æ³›è®¤çŸ¥çš„

### 2. æ–‡ä»¶å‘½åè§„èŒƒ
- Goæ–‡ä»¶ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿
- æµ‹è¯•æ–‡ä»¶ä»¥`_test.go`ç»“å°¾
- é…ç½®æ–‡ä»¶ä½¿ç”¨`.yaml`æˆ–`.yml`æ‰©å±•å

### 3. åŒ…ç»„ç»‡è§„èŒƒ
- æ¯ä¸ªåŒ…åº”è¯¥æœ‰å•ä¸€çš„èŒè´£
- åŒ…ååº”è¯¥ç®€æ´ä¸”å…·æœ‰æè¿°æ€§
- é¿å…å¾ªç¯ä¾èµ–

### 4. ä»£ç ç»“æ„è§„èŒƒ
- å…¬å…±æ¥å£æ”¾åœ¨åŒ…çš„é¡¶å±‚
- å®ç°ç»†èŠ‚æ”¾åœ¨å†…éƒ¨åŒ…ä¸­
- ä½¿ç”¨æ¥å£æ¥å®šä¹‰å¥‘çº¦

---

## ğŸ“ˆ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„å¾®æœåŠ¡
1. åœ¨`/cmd/openim-rpc/`ä¸‹åˆ›å»ºæ–°çš„æœåŠ¡ç›®å½•
2. åœ¨`/internal/rpc/`ä¸‹å®ç°ä¸šåŠ¡é€»è¾‘
3. åœ¨`/pkg/rpcli/`ä¸‹æ·»åŠ RPCå®¢æˆ·ç«¯
4. æ›´æ–°é…ç½®æ–‡ä»¶å’Œéƒ¨ç½²è„šæœ¬

### æ·»åŠ æ–°çš„APIç«¯ç‚¹
1. åœ¨`/internal/api/`ä¸‹æ·»åŠ æ–°çš„å¤„ç†å‡½æ•°
2. åœ¨`/pkg/apistruct/`ä¸‹å®šä¹‰APIç»“æ„ä½“
3. æ›´æ–°è·¯ç”±é…ç½®
4. æ·»åŠ ç›¸åº”çš„æµ‹è¯•

### æ·»åŠ æ–°çš„å­˜å‚¨åç«¯
1. åœ¨`/pkg/common/storage/`ä¸‹å®ç°å­˜å‚¨æ¥å£
2. åœ¨`/pkg/common/storage/controller/`ä¸‹æ·»åŠ æ§åˆ¶å™¨
3. æ›´æ–°é…ç½®æ–‡ä»¶
4. æ·»åŠ ç›¸åº”çš„æµ‹è¯•

---

## ğŸ”— æ€»ç»“

OpenIMçš„é¡¹ç›®ç»“æ„ä½“ç°äº†ç°ä»£Goé¡¹ç›®çš„æœ€ä½³å®è·µï¼š

1. **æ¸…æ™°çš„å±‚æ¬¡ç»“æ„**: ä»åº”ç”¨å…¥å£åˆ°ä¸šåŠ¡é€»è¾‘å†åˆ°å…¬å…±åº“çš„æ¸…æ™°åˆ†å±‚
2. **èŒè´£åˆ†ç¦»**: æ¯ä¸ªç›®å½•å’Œæ–‡ä»¶éƒ½æœ‰æ˜ç¡®çš„èŒè´£
3. **æ˜“äºæ‰©å±•**: æ¨¡å—åŒ–çš„è®¾è®¡ä¾¿äºæ·»åŠ æ–°åŠŸèƒ½
4. **æ ‡å‡†åŒ–**: éµå¾ªGoç¤¾åŒºçš„æ ‡å‡†é¡¹ç›®å¸ƒå±€
5. **å®Œæ•´çš„å·¥å…·é“¾**: ä»æ„å»ºåˆ°éƒ¨ç½²åˆ°æµ‹è¯•çš„å®Œæ•´å·¥å…·æ”¯æŒ

è¿™ç§é¡¹ç›®ç»“æ„ä¸ä»…ä¾¿äºå¼€å‘å’Œç»´æŠ¤ï¼Œä¹Ÿä¸ºæ–°åŠ å…¥çš„å¼€å‘è€…æä¾›äº†è‰¯å¥½çš„ä»£ç å¯¼èˆªå’Œç†è§£åŸºç¡€ã€‚

---

*æœ¬æ–‡æ¡£åŸºäºOpenIM v3.8.3ç‰ˆæœ¬ç¼–å†™ï¼Œè¯¦ç»†è¯´æ˜äº†é¡¹ç›®çš„ç›®å½•ç»“æ„å’Œç»„ç»‡æ–¹å¼ã€‚*